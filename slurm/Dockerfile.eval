FROM vllm/vllm-openai:latest

# Configure project dir
ARG PROJECT_DIR=/workspace
ENV PROJECT_DIR="${PROJECT_DIR}"

# Set working directory
WORKDIR ${PROJECT_DIR}

# Clone lmms-eval at specific commit
RUN git clone https://github.com/EvolvingLMMs-Lab/lmms-eval.git \
    && cd lmms-eval \
    && git fetch --depth 1 origin 69e52879479f273833fe439b58c7e002d27a93aa \
    && git checkout 69e52879479f273833fe439b58c7e002d27a93aa

# Install lmms-eval
RUN pip install ./lmms-eval

# Caches inside mounted directory
ENV HF_HOME="${PROJECT_DIR}/.hf"

ENTRYPOINT ["/bin/bash"]
CMD ["-l"]